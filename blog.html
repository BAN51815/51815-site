
<h2>ブログ一覧</h2>
<div id="blog-list"></div>

<style>
  #blog-list {
    display: flex;
    flex-direction: column;
    gap: 1rem;
    margin-top: 1rem;
  }

  .blog-card {
    display: flex;
    gap: 1rem;
    border: 1px solid #ccc;
    border-radius: 6px;
    background: #fff;
    padding: 1rem;
    align-items: flex-start;
  }

  .blog-card:hover {
    background: #f4f4f4;
  }

  .blog-card img.thumb {
    width: 100px;
    height: 100px;
    object-fit: cover;
    flex-shrink: 0;
    border-radius: 4px;
  }

  .blog-text {
    flex-grow: 1;
  }

  .blog-text h3 {
    margin: 0;
    font-size: 1.1rem;
    color: #006;
    text-decoration: underline;
  }

  .blog-text .excerpt {
    margin: 0.5rem 0;
    font-size: 0.95rem;
  }

  .blog-text .meta {
    font-size: 0.8rem;
    color: #888;
  }
</style>

<script type="module">
  import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";
  const supabase = createClient(
    "https://odpjnxcyvcmivmccxtyo.supabase.co",
    "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzIiw..."
  );

  const container = document.getElementById("blog-list");

  async function loadPosts() {
    const { data, error } = await supabase
      .from("blogs")
      .select("*")
      .eq("is_visible", true)
      .order("created_at", { ascending: false });

    if (error) {
      container.innerHTML = "<p>記事の読み込みに失敗しました。</p>";
      console.error(error);
      return;
    }

    if (!data.length) {
      container.innerHTML = "<p>公開中のブログ記事はありません。</p>";
      return;
    }

    data.forEach(post => {
      const div = document.createElement("div");
      div.className = "blog-card";

      const imageHTML = post.thumbnail_url
        ? `<img class="thumb" src="${post.thumbnail_url}" alt="thumbnail">`
        : `<div class="thumb" style="width:100px;height:100px;background:#ddd;border-radius:4px;"></div>`;

      const plainText = (post.body || "").replace(/<[^>]*>/g, "").slice(0, 100);

      div.innerHTML = `
        ${imageHTML}
        <div class="blog-text">
          <h3><a href="blog-detail.html?slug=${encodeURIComponent(post.slug)}">${post.title}</a></h3>
          <p class="excerpt">${plainText}...</p>
          <p class="meta">${post.category || "未分類"}｜${new Date(post.created_at).toLocaleDateString()}</p>
        </div>
      `;

      container.appendChild(div);
    });
  }

  loadPosts();
</script>
