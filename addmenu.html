
<main class="p-4">
  <h1 class="text-xl font-bold mb-4">ç®¡ç†ãƒ¡ãƒ‹ãƒ¥ãƒ¼è¿½åŠ ãƒ»ç·¨é›†ãƒ»å‰Šé™¤ï¼ˆãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰ï¼‰</h1>
  <div class="mb-4 flex gap-2">
    <input id="title-input" placeholder="ã‚¿ã‚¤ãƒˆãƒ«" class="border p-1 rounded w-40">
    <input id="path-input" placeholder="ãƒ‘ã‚¹" class="border p-1 rounded w-40">
    <button id="add-button" class="bg-blue-500 text-white px-3 py-1 rounded">è¿½åŠ </button>
  </div>
  <table class="w-full border text-sm">
    <thead class="bg-gray-100">
      <tr>
        <th class="border px-2 py-1">ã‚¿ã‚¤ãƒˆãƒ«</th>
        <th class="border px-2 py-1">ãƒ‘ã‚¹</th>
        <th class="border px-2 py-1">æ“ä½œ</th>
      </tr>
    </thead>
    <tbody id="menu-table"></tbody>
  </table>
</main>

<script type="module">
console.log("âœ… JSé–‹å§‹ï¼šãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚¹ã‚¯ãƒªãƒ—ãƒˆå‹•ä½œä¸­");

import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";
const supabase = createClient(
  "https://odpjnxcyvcmivmccxtyo.supabase.co",
  "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9kcGpueGN5dmNtaXZtY2N4dHlvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MTcwNTYxNDksImV4cCI6MjAzMjYzMjE0OX0.mEA8aT-Pa3UHgMQh19K5X82idAy28vv0ndWeClqRDLU"
);

const { data: authUser, error: authError } = await supabase.auth.getUser();
console.log("ğŸ”‘ èªè¨¼ãƒã‚§ãƒƒã‚¯çµæœï¼š", authUser);
if (!authUser?.user) {
  console.warn("ğŸš« æœªãƒ­ã‚°ã‚¤ãƒ³ã€‚ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã—ã¾ã™");
  location.href = "admin-login.html";
}

loadMenu();

async function loadMenu() {
  console.log("ğŸ“¥ ãƒ¡ãƒ‹ãƒ¥ãƒ¼èª­ã¿è¾¼ã¿é–‹å§‹...");
  const { data, error } = await supabase.from("admin_menus").select("*").order("order", { ascending: true });
  if (error) {
    console.error("âŒ ãƒ‡ãƒ¼ã‚¿å–å¾—ã‚¨ãƒ©ãƒ¼:", error);
    return;
  }
  console.log("âœ… ãƒ¡ãƒ‹ãƒ¥ãƒ¼å–å¾—æˆåŠŸ:", data);

  const table = document.getElementById("menu-table");
  table.innerHTML = "";
  data.forEach((item) => {
    const row = document.createElement("tr");
    row.innerHTML = `
      <td class="border px-2 py-1"><input value="${item.title}" class="border rounded w-full px-1 py-0.5" data-id="${item.id}" data-field="title"></td>
      <td class="border px-2 py-1"><input value="${item.path}" class="border rounded w-full px-1 py-0.5" data-id="${item.id}" data-field="path"></td>
      <td class="border px-2 py-1 text-center">
        <button class="bg-green-500 text-white px-2 py-0.5 rounded save-button" data-id="${item.id}">ä¿å­˜</button>
        <button class="bg-red-500 text-white px-2 py-0.5 rounded delete-button" data-id="${item.id}">å‰Šé™¤</button>
      </td>
    `;
    table.appendChild(row);
  });

  document.querySelectorAll(".save-button").forEach((btn) => {
    btn.addEventListener("click", async () => {
      const id = btn.dataset.id;
      const title = document.querySelector(`input[data-id='${id}'][data-field='title']`).value;
      const path = document.querySelector(`input[data-id='${id}'][data-field='path']`).value;
      await supabase.from("admin_menus").update({ title, path }).eq("id", id);
      loadMenu();
    });
  });

  document.querySelectorAll(".delete-button").forEach((btn) => {
    btn.addEventListener("click", async () => {
      const id = btn.dataset.id;
      if (confirm("å‰Šé™¤ã—ã¦ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ")) {
        await supabase.from("admin_menus").delete().eq("id", id);
        loadMenu();
      }
    });
  });
}

document.getElementById("add-button").addEventListener("click", async () => {
  const title = document.getElementById("title-input").value;
  const path = document.getElementById("path-input").value;
  if (!title || !path) return alert("ã‚¿ã‚¤ãƒˆãƒ«ã¨ãƒ‘ã‚¹ã¯å¿…é ˆã§ã™");
  await supabase.from("admin_menus").insert({ title, path });
  document.getElementById("title-input").value = "";
  document.getElementById("path-input").value = "";
  loadMenu();
});
</script>
