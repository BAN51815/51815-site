
<main class="p-4">
  <h1 class="text-xl font-bold mb-4">管理メニュー追加・編集・削除</h1>
  <div class="mb-4 flex gap-2">
    <input id="title-input" placeholder="タイトル" class="border p-1 rounded w-40">
    <input id="path-input" placeholder="パス" class="border p-1 rounded w-40">
    <input id="icon-input" placeholder="アイコン（例：📁）" class="border p-1 rounded w-32">
    <button id="add-button" class="bg-blue-500 text-white px-3 py-1 rounded">追加</button>
  </div>
  <table class="w-full border text-sm">
    <thead class="bg-gray-100">
      <tr>
        <th class="border px-2 py-1">タイトル</th>
        <th class="border px-2 py-1">パス</th>
        <th class="border px-2 py-1">アイコン</th>
        <th class="border px-2 py-1">操作</th>
      </tr>
    </thead>
    <tbody id="menu-table"></tbody>
  </table>
</main>

<script type="module">
import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

const supabase = createClient(
  "https://odpjnxcyvcmivmccxtyo.supabase.co",
  "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9kcGpueGN5dmNtaXZtY2N4dHlvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MTcwNTYxNDksImV4cCI6MjAzMjYzMjE0OX0.mEA8aT-Pa3UHgMQh19K5X82idAy28vv0ndWeClqRDLU"
);

const user = await supabase.auth.getUser();
if (!user.data?.user) location.href = "admin-login.html";

loadMenu();

async function loadMenu() {
  const { data, error } = await supabase.from("admin_menus").select("*").order("order", { ascending: true });
  const table = document.getElementById("menu-table");
  table.innerHTML = "";
  data.forEach((item) => {
    const row = document.createElement("tr");
    row.innerHTML = `
      <td class="border px-2 py-1"><input value="${item.title}" class="border rounded w-full px-1 py-0.5" data-id="${item.id}" data-field="title"></td>
      <td class="border px-2 py-1"><input value="${item.path}" class="border rounded w-full px-1 py-0.5" data-id="${item.id}" data-field="path"></td>
      <td class="border px-2 py-1"><input value="${item.icon}" class="border rounded w-full px-1 py-0.5" data-id="${item.id}" data-field="icon"></td>
      <td class="border px-2 py-1 text-center">
        <button class="bg-green-500 text-white px-2 py-0.5 rounded save-button" data-id="${item.id}">保存</button>
        <button class="bg-red-500 text-white px-2 py-0.5 rounded delete-button" data-id="${item.id}">削除</button>
      </td>
    `;
    table.appendChild(row);
  });

  document.querySelectorAll(".save-button").forEach((btn) => {
    btn.addEventListener("click", async () => {
      const id = btn.dataset.id;
      const title = document.querySelector(`input[data-id='${id}'][data-field='title']`).value;
      const path = document.querySelector(`input[data-id='${id}'][data-field='path']`).value;
      const icon = document.querySelector(`input[data-id='${id}'][data-field='icon']`).value;
      await supabase.from("admin_menus").update({ title, path, icon }).eq("id", id);
      loadMenu();
    });
  });

  document.querySelectorAll(".delete-button").forEach((btn) => {
    btn.addEventListener("click", async () => {
      const id = btn.dataset.id;
      if (confirm("削除してよろしいですか？")) {
        await supabase.from("admin_menus").delete().eq("id", id);
        loadMenu();
      }
    });
  });
}

document.getElementById("add-button").addEventListener("click", async () => {
  const title = document.getElementById("title-input").value;
  const path = document.getElementById("path-input").value;
  const icon = document.getElementById("icon-input").value;
  if (!title || !path) return alert("タイトルとパスは必須です");
  await supabase.from("admin_menus").insert({ title, path, icon });
  document.getElementById("title-input").value = "";
  document.getElementById("path-input").value = "";
  document.getElementById("icon-input").value = "";
  loadMenu();
});
</script>
